<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laporan Komisi | Mahika Trans</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #065084; --bg: #043a60; --white: #ffffff; --gold: #FFD700; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg); margin: 0; color: var(--white); padding: 20px; }
        .container { max-width: 450px; margin: auto; }
        
        /* Header Jumlah Komisi */
        .header-box { 
            background: rgba(255,255,255,0.1); border: 2px dashed var(--gold); 
            border-radius: 15px; padding: 20px; text-align: center; margin-bottom: 20px;
        }
        .header-box span { font-size: 12px; opacity: 0.8; text-transform: uppercase; }
        .header-box h2 { margin: 5px 0 0; color: var(--gold); font-size: 24px; letter-spacing: 1px; }

        select { 
            width: 100%; padding: 12px; border-radius: 10px; border: none; 
            margin-bottom: 15px; font-weight: 600; color: var(--primary);
        }

        .table-card { background: var(--white); border-radius: 15px; overflow: hidden; box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        table { width: 100%; border-collapse: collapse; color: #333; font-size: 14px; }
        th { background: #f1f1f1; padding: 15px 10px; text-align: left; color: var(--primary); }
        td { padding: 15px 10px; border-bottom: 1px solid #eee; }
        
        .fab { 
            position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; 
            background: var(--gold); color: var(--primary); border-radius: 50%; 
            display: flex; justify-content: center; align-items: center; 
            font-size: 24px; box-shadow: 0 5px 15px rgba(0,0,0,0.4); text-decoration: none;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-box">
        <span id="labelBulan">Total Komisi</span>
        <h2 id="totalDisplay">Rp 0</h2>
    </div>

    <select id="filterBulan">
        <option value="01">Januari</option><option value="02">Februari</option>
        <option value="03">Maret</option><option value="04">April</option>
        <option value="05">Mei</option><option value="06">Juni</option>
        <option value="07">Juli</option><option value="08">Agustus</option>
        <option value="09">September</option><option value="10">Oktober</option>
        <option value="11">November</option><option value="12">Desember</option>
    </select>

    <div class="table-card">
        <table>
            <thead><tr><th>Tanggal</th><th>Pax</th><th>Komisi</th></tr></thead>
            <tbody id="dataBody"></tbody>
        </table>
    </div>
</div>

<a href="input_komisi.html" class="fab"><i class="fas fa-plus"></i></a>

<script>
    const API = "https://script.google.com/macros/s/AKfycbwYjU8eEgrFHW9w6WsVPUw6H1GJOlXda_6Z-AhWmCBYRzAqCh2Rr8JO1WlDS3KH6YC9/exec";
    
    // Set bulan otomatis
    const m = ("0" + (new Date().getMonth() + 1)).slice(-2);
    document.getElementById('filterBulan').value = m;

    async function fetchData() {
        const resp = await fetch(`${API}?action=getPendapatan`);
        const data = await resp.json();
        
        const render = () => {
            const bul = document.getElementById('filterBulan').value;
            const nmBul = document.getElementById('filterBulan').options[document.getElementById('filterBulan').selectedIndex].text;
            let html = "", total = 0;

            data.filter(r => r.tanggal && r.tanggal.split("-")[1] === bul)
                .sort((a,b) => new Date(a.tanggal) - new Date(b.tanggal))
                .forEach(r => {
                    html += `<tr><td>${r.tanggal.split("-")[2]} ${nmBul.substring(0,3)}</td><td>${r.pax}</td><td>Rp ${parseInt(r.komisi).toLocaleString()}</td></tr>`;
                    total += parseInt(r.komisi);
                });

            document.getElementById('dataBody').innerHTML = html || "<tr><td colspan='3' style='text-align:center'>Tidak ada data</td></tr>";
            document.getElementById('totalDisplay').innerText = "Rp " + total.toLocaleString();
            document.getElementById('labelBulan').innerText = `Total Komisi ${nmBul}`;
        };

        document.getElementById('filterBulan').onchange = render;
        render();
    }
    window.onload = fetchData;
</script>
</body>
</html>
