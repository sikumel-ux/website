var SHEET_NAME = "penumpang";

function doGet(e) {
  var action = e.parameter.action;
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var sheet = ss.getSheetByName(SHEET_NAME);
  
  // Jika tab belum ada, buat otomatis
  if (!sheet) {
    sheet = ss.insertSheet(SHEET_NAME);
    sheet.appendRow(["Tanggal", "Jam", "Nama", "No HP", "Armada", "Tujuan", "No Kursi", "Harga", "Kode"]);
  }

  // Ambil Data
  if (action === 'readManifes') {
    var data = sheet.getDataRange().getValues();
    var result = [];
    
    // Mulai dari baris ke-2 (index 1)
    for (var i = 1; i < data.length; i++) {
      if(!data[i][8]) continue; // Jika Kode di Kolom I (index 8) kosong, skip
      
      result.push({
        tanggal: data[i][0], // A
        jam:     data[i][1], // B
        nama:    data[i][2], // C
        hp:      data[i][3], // D
        armada:  data[i][4], // E
        tujuan:  data[i][5], // F
        kursi:   data[i][6], // G
        kode:    data[i][8]  // I
      });
    }
    return kembalikanJSON({ status: "success", data: result });
  }

  // Hapus Data
  if (action === 'deleteBooking') {
    var kode = e.parameter.kode;
    var data = sheet.getDataRange().getValues();
    for (var i = 0; i < data.length; i++) {
      if (data[i][8] == kode) {
        sheet.deleteRow(i + 1);
        return kembalikanJSON({ status: "success" });
      }
    }
    return kembalikanJSON({ status: "error" });
  }
}

function kembalikanJSON(objek) {
  return ContentService.createTextOutput(JSON.stringify(objek))
    .setMimeType(ContentService.MimeType.JSON);
}
        
